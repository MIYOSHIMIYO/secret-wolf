# 秘密人狼 ウェブブラウザ配布移行指示書

## 1. 移行の背景と目的

### 1.1 現状の課題
- **ストア審査の複雑性**: App Store・Google Playの審査プロセスが予想以上に複雑で、リリースが遅延
- **技術的負担**: Capacitor、RevenueCat、AdMob等のモバイルアプリ特有の機能が開発・運用の負担となっている
- **配布の制約**: ストア経由の配布により、ユーザーアクセスに障壁が存在

### 1.2 移行の目的
- **迅速なリリース**: ストア審査を経ずに即座にサービスを開始
- **開発効率の向上**: モバイルアプリ特有の複雑性を排除し、開発リソースをゲーム機能に集中
- **ユーザーアクセスの向上**: インストール不要で、どのデバイスからでも即座にプレイ可能
- **コスト削減**: ストア手数料（30%）の排除と運用コストの削減

## 2. 移行戦略

### 2.1 MVP再定義
- **収益手段の集中**: 初回ウェブ版では「課金機能」のみに集中し、広告機能は後回し
- **最小限の機能**: ゲームの核心機能と課金機能のみでリリース
- **段階的機能追加**: 基本機能の安定後、広告・PWA等の機能を追加

### 2.2 技術検証スプリント（事前実施）
- **WebSocket遅延測定**: ブラウザ版での通信性能を詳細測定
- **PWAインストーラビリティ**: 各種デバイスでのPWAインストール可能性を検証
- **AdSense審査要件**: 将来的な広告導入時の審査要件を事前確認
- **決済システム検証**: Stripe統合の技術的実現可能性を確認

### 2.3 技術的アプローチ
- **フロントエンド**: 現在のReact実装をそのまま活用、レスポンシブデザインを強化
- **バックエンド**: Cloudflare Workersの実装を維持、CORS設定をウェブ配布用に調整
- **課金システム**: ストア連携からStripe決済に変更（MVPでは課金のみ）
- **広告システム**: 初回リリースでは実装せず、後段階で検討

## 3. 機能要件の変更

### 3.1 維持する機能
- **ゲームロジック**: 人狼ゲームの核心機能は完全に維持
- **WebSocket通信**: リアルタイム通信機能はそのまま
- **自動モデレーション**: 既存の通報・フィルタリング機能を維持
- **マルチデバイス対応**: スマートフォン、タブレット、PCすべてで動作

### 3.2 変更・簡素化する機能

#### 3.2.1 課金システム（MVP優先）
- **現在**: RevenueCat + ストア連携（複雑な設定と審査が必要）
- **変更後**: Stripe決済（シンプルな設定、MVPでは唯一の収益手段）
- **実装優先度**: 最優先
- **メリット**: 
  - ストア手数料（30%）の排除
  - 審査プロセスの簡素化
  - より柔軟な価格設定
  - 税務処理の簡素化

#### 3.2.2 広告システム（後回し）
- **現在**: AdMob（モバイルアプリ専用）
- **将来**: Google AdSense等のウェブ広告（Phase 2以降で検討）
- **理由**: MVPでは課金機能に集中し、複雑性を排除
- **検証項目**: AdSense審査要件の事前確認が必要

#### 3.2.3 配布方法
- **現在**: ストア経由（インストール必要）
- **変更後**: URL共有（即座にアクセス可能）
- **メリット**:
  - インストール障壁の排除
  - 共有の容易さ
  - 更新の即座性

### 3.3 新たに追加する機能

#### 3.3.1 PWA（Progressive Web App）機能
- **目的**: アプリライクな体験の提供
- **機能**:
  - ホーム画面への追加
  - オフライン対応（基本機能）
  - プッシュ通知（将来実装）
- **iOS制約**: Safariでのプッシュ通知未対応、バックグラウンド制限
- **Android優位**: Chromeでの完全なPWA機能

#### 3.3.2 レスポンシブデザインの強化
- **目的**: あらゆるデバイスでの最適な体験
- **対応範囲**:
  - スマートフォン（縦・横）
  - タブレット（縦・横）
  - PC（デスクトップ・ノートPC）

## 4. セキュリティ・プライバシー対応

### 4.1 セキュリティ強化
- **HTTPS強制**: すべての通信を暗号化
- **CSP（Content Security Policy）**: XSS攻撃の防止
- **セキュリティヘッダー**: 適切なHTTPヘッダーでセキュリティを強化
- **レート制限**: 既存の実装を維持・強化

### 4.2 プライバシー保護
- **データ最小化**: ゲーム進行に必要な最小限のデータのみ収集
- **一時的データ**: セッション終了時に即座に削除
- **匿名性**: 実名や個人情報は一切収集しない
- **透明性**: プライバシーポリシーで明確に開示

## 5. ユーザー体験の向上

### 5.1 アクセシビリティの向上
- **インストール不要**: ブラウザがあれば即座にプレイ可能
- **デバイス制約なし**: どのデバイスからでも同じ体験
- **共有の容易さ**: URLを送るだけで友達と一緒にプレイ

### 5.2 パフォーマンスの最適化
- **高速読み込み**: ストアアプリより軽量で高速
- **更新の即座性**: サーバー側の更新で全ユーザーに即座に反映
- **キャッシュ最適化**: ブラウザキャッシュを活用した高速化

## 6. ビジネス面でのメリット

### 6.1 コスト削減
- **ストア手数料**: 30%の手数料が不要
- **審査費用**: ストア審査のための時間・コストが不要
- **開発効率**: モバイルアプリ特有の複雑性を排除

### 6.2 収益機会の拡大
- **柔軟な価格設定**: ストアの制約を受けない価格設定
- **多様な決済方法**: より多くの決済オプションを提供可能
- **グローバル展開**: 地域制約の少ない配布

### 6.3 マーケティングの容易さ
- **URL共有**: SNS等での簡単な共有
- **SEO対応**: 検索エンジンでの発見可能性
- **A/Bテスト**: より簡単な機能テスト

## 7. 実装計画

### 7.0 事前検証スプリント（1週間）
- **WebSocket遅延測定**: ブラウザ版での通信性能を詳細測定
- **PWAインストーラビリティ**: 各種デバイスでのPWAインストール可能性を検証
- **AdSense審査要件**: 将来的な広告導入時の審査要件を事前確認
- **Stripe統合検証**: 決済システムの技術的実現可能性を確認

### 7.1 Phase 1: MVP基盤整備（2-3週間）
- **課金システムの実装**: Stripe決済（唯一の収益手段）
- **レスポンシブデザインの調整**: 全デバイス対応
- **基本PWA機能**: インストール可能なPWA（iOS制約考慮）
- **法務・税務対応**: 利用規約・プライバシーポリシー更新
- **KYC/反社チェック**: 必要に応じた本人確認・反社会的勢力チェック
- **チャージバック対応**: 不正利用・返金要求への対応体制

### 7.2 Phase 2: テスト・最適化（1週間）
- 各種デバイスでの動作確認
- パフォーマンステスト
- セキュリティテスト
- ユーザビリティテスト

### 7.3 Phase 3: リリース・運用（継続）
- ドメイン取得・設定
- SSL証明書の設定
- 監視・ログ設定
- ユーザーフィードバック収集

### 7.4 Phase 4: 機能拡張（将来）
- 広告システムの追加（Google AdSense）
- 高度なPWA機能
- ソーシャル機能の強化

## 8. リスク管理

### 8.1 技術的リスク
- **WebSocket遅延**: 事前検証スプリントで詳細測定・最適化
- **ブラウザ互換性**: 主要ブラウザでの動作確認
- **PWAインストール**: 各種デバイスでの互換性検証
- **iOS Safari制約**: プッシュ通知未対応、バックグラウンド制限
- **パフォーマンス**: 大量アクセス時の対応
- **セキュリティ**: 定期的なセキュリティ監査

### 8.2 ビジネスリスク
- **課金システム**: Stripe統合の技術的実現可能性
- **法務・税務**: 利用規約・税務処理の適切な対応
- **ユーザー受容性**: 段階的なリリースでフィードバック収集
- **競合対応**: 差別化機能の継続的開発
- **技術的負債**: 定期的なコードレビュー・リファクタリング

### 8.3 運用リスク
- **監視体制**: 適切な監視指標・ログ粒度の設定
- **サポート体制**: ブラウザ版特有の問題への対応準備
- **クラッシュ報告**: ブラウザ版でのエラー報告・対応フロー

## 9. 成功指標

### 9.1 技術指標
- **ページ読み込み時間**: 3秒以内
- **WebSocket接続時間**: 2秒以内
- **エラー率**: 1%未満
- **稼働率**: 99%以上

### 9.2 ビジネス指標
- **ユーザー数**: 月間アクティブユーザー数
- **収益**: 月間売上
- **ユーザー満足度**: フィードバック評価
- **リテンション**: 継続利用率

## 10. 今後の展望

### 10.1 短期（3-6ヶ月）
- ウェブ版の安定運用
- ユーザーフィードバックに基づく機能改善
- パフォーマンス最適化

### 10.2 中期（6-12ヶ月）
- 新機能の追加（プッシュ通知、オフライン対応等）
- 多言語対応の検討
- ソーシャル機能の強化

### 10.3 長期（1年以上）
- 必要に応じてネイティブアプリ化の検討
- グローバル展開
- エンタープライズ向け機能の検討

---

**この移行により、より多くのユーザーにリーチでき、開発・運用の負担を大幅に軽減しながら、持続可能なサービス運営を実現します。**
