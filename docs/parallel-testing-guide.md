# 並行テスト環境ガイド

## 概要
本番環境での実機テストとブラウザ（開発環境）でのテストを同時に行うためのガイドです。

## 環境構成

### 本番環境（実機テスト）
- **サーバー**: `https://secret-werewolf-prod.qmdg2pmnw6.workers.dev`
- **クライアント**: Capacitorネイティブアプリ（iOS/Android）
- **データ**: 本番データ（実際のユーザーデータと分離）

### 開発環境（ブラウザテスト）
- **サーバー**: `http://localhost:8787`（ローカル開発サーバー）
- **クライアント**: ブラウザ（Chrome、Safari、Firefox等）
- **データ**: 開発データ（テスト用データ）

## セットアップ手順

### 1. 開発環境の起動

```bash
# ターミナル1: 開発サーバー起動
cd /Users/miyoshiyuudai/Desktop/秘密人狼/packages/worker
npm run dev

# ターミナル2: クライアント開発サーバー起動
cd /Users/miyoshiyuudai/Desktop/秘密人狼/packages/client
npm run dev
```

### 2. 本番環境の起動

```bash
# ターミナル3: 本番ビルドとネイティブアプリ起動
cd /Users/miyoshiyuudai/Desktop/秘密人狼/packages/client
npm run build:production
npx cap sync
npx cap open ios  # または npx cap open android
```

## テスト実行方法

### 同時テストの実行

1. **開発環境（ブラウザ）**: `http://localhost:5173`
2. **本番環境（実機）**: ネイティブアプリ

### テストシナリオ例

#### 基本機能テスト
- ルーム作成・参加
- ゲーム進行
- チャット機能
- 投票機能

#### クロスプラットフォームテスト
- 同じルームIDで異なる環境から参加
- データの分離確認
- UI/UXの一貫性確認

## 問題切り分け

### 設計問題の特定
- 両環境で同じ問題が発生 → 設計・ロジックの問題
- 特定の環境でのみ発生 → 環境固有の問題

### サーバー問題の特定
- 本番環境でのみ発生 → 本番サーバーの問題
- 開発環境でのみ発生 → 開発サーバーの問題

### Capacitor問題の特定
- ネイティブアプリでのみ発生 → Capacitor設定の問題
- ブラウザでのみ発生 → ブラウザ固有の問題

## デバッグツール

### 開発環境
- ブラウザの開発者ツール
- 詳細なログ出力
- ネットワークタブでの通信確認

### 本番環境
- Capacitorのデバッグモード
- 実機でのログ確認
- パフォーマンス監視

## 注意事項

1. **データ分離**: 本番環境と開発環境のデータは完全に分離されています
2. **CORS設定**: 本番環境は`capacitor://localhost`のみ許可
3. **レート制限**: 本番環境では厳しいレート制限が適用されます
4. **ログレベル**: 本番環境ではログが制限されます

## トラブルシューティング

### よくある問題

1. **WebSocket接続エラー**
   - 環境変数の確認
   - サーバーの起動確認
   - ネットワーク設定の確認

2. **CORSエラー**
   - 本番環境ではブラウザからの直接アクセス不可
   - 開発環境でのテストを推奨

3. **Capacitorビルドエラー**
   - `npx cap sync`の実行
   - 依存関係の確認
   - プラットフォーム固有の設定確認

## テスト結果の記録

### 記録すべき項目
- テスト環境（本番/開発）
- プラットフォーム（iOS/Android/ブラウザ）
- テストシナリオ
- 発見された問題
- 解決方法
- パフォーマンス指標

### 推奨ツール
- スクリーンショット
- ログファイル
- パフォーマンス測定
- ユーザビリティテスト結果
